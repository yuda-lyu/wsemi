<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>domDrag.mjs - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="wsemi.html">wsemi</a><ul class='methods'><li data-type='method'><a href="wsemi.html#.ab2blob">ab2blob</a></li><li data-type='method'><a href="wsemi.html#.ab2u8arr">ab2u8arr</a></li><li data-type='method'><a href="wsemi.html#.addMonth">addMonth</a></li><li data-type='method'><a href="wsemi.html#.aes2str">aes2str</a></li><li data-type='method'><a href="wsemi.html#.alive">alive</a></li><li data-type='method'><a href="wsemi.html#.arr2dt">arr2dt</a></li><li data-type='method'><a href="wsemi.html#.arraccum">arraccum</a></li><li data-type='method'><a href="wsemi.html#.arradd">arradd</a></li><li data-type='method'><a href="wsemi.html#.arrat">arrat</a></li><li data-type='method'><a href="wsemi.html#.arrdiff">arrdiff</a></li><li data-type='method'><a href="wsemi.html#.arrfind">arrfind</a></li><li data-type='method'><a href="wsemi.html#.arrhas">arrhas</a></li><li data-type='method'><a href="wsemi.html#.arrpull">arrpull</a></li><li data-type='method'><a href="wsemi.html#.b642obj">b642obj</a></li><li data-type='method'><a href="wsemi.html#.b642str">b642str</a></li><li data-type='method'><a href="wsemi.html#.b642u8arr">b642u8arr</a></li><li data-type='method'><a href="wsemi.html#.b642u16arr">b642u16arr</a></li><li data-type='method'><a href="wsemi.html#.binstr">binstr</a></li><li data-type='method'><a href="wsemi.html#.blob2ab">blob2ab</a></li><li data-type='method'><a href="wsemi.html#.blob2b64">blob2b64</a></li><li data-type='method'><a href="wsemi.html#.blob2str">blob2str</a></li><li data-type='method'><a href="wsemi.html#.blob2u8arr">blob2u8arr</a></li><li data-type='method'><a href="wsemi.html#.blobs2b64s">blobs2b64s</a></li><li data-type='method'><a href="wsemi.html#.blobs2u8arrs">blobs2u8arrs</a></li><li data-type='method'><a href="wsemi.html#.bodyLog">bodyLog</a></li><li data-type='method'><a href="wsemi.html#.bs2u8arr">bs2u8arr</a></li><li data-type='method'><a href="wsemi.html#.bufRead">bufRead</a></li><li data-type='method'><a href="wsemi.html#.bufReadDbl">bufReadDbl</a></li><li data-type='method'><a href="wsemi.html#.bufWrite">bufWrite</a></li><li data-type='method'><a href="wsemi.html#.bufWriteDbl">bufWriteDbl</a></li><li data-type='method'><a href="wsemi.html#.cache">cache</a></li><li data-type='method'><a href="wsemi.html#.cbol">cbol</a></li><li data-type='method'><a href="wsemi.html#.cdbl">cdbl</a></li><li data-type='method'><a href="wsemi.html#.cfilesize">cfilesize</a></li><li data-type='method'><a href="wsemi.html#.cfinancial">cfinancial</a></li><li data-type='method'><a href="wsemi.html#.cint">cint</a></li><li data-type='method'><a href="wsemi.html#.clearXSS">clearXSS</a></li><li data-type='method'><a href="wsemi.html#.cstr">cstr</a></li><li data-type='method'><a href="wsemi.html#.day2cht">day2cht</a></li><li data-type='method'><a href="wsemi.html#.debounce">debounce</a></li><li data-type='method'><a href="wsemi.html#.delay">delay</a></li><li data-type='method'><a href="wsemi.html#.dig">dig</a></li><li data-type='method'><a href="wsemi.html#.digExp">digExp</a></li><li data-type='method'><a href="wsemi.html#.domAppend">domAppend</a></li><li data-type='method'><a href="wsemi.html#.domDetect">domDetect</a></li><li data-type='method'><a href="wsemi.html#.domDrag">domDrag</a></li><li data-type='method'><a href="wsemi.html#.domDragDyn">domDragDyn</a></li><li data-type='method'><a href="wsemi.html#.domDropFiles">domDropFiles</a></li><li data-type='method'><a href="wsemi.html#.domFadeIn">domFadeIn</a></li><li data-type='method'><a href="wsemi.html#.domFadeOut">domFadeOut</a></li><li data-type='method'><a href="wsemi.html#.domFind">domFind</a></li><li data-type='method'><a href="wsemi.html#.domFinds">domFinds</a></li><li data-type='method'><a href="wsemi.html#.domGetBounding">domGetBounding</a></li><li data-type='method'><a href="wsemi.html#.domGetFileAccept">domGetFileAccept</a></li><li data-type='method'><a href="wsemi.html#.domGetFiles">domGetFiles</a></li><li data-type='method'><a href="wsemi.html#.domGetOffset">domGetOffset</a></li><li data-type='method'><a href="wsemi.html#.domIsPageXYIn">domIsPageXYIn</a></li><li data-type='method'><a href="wsemi.html#.domRemove">domRemove</a></li><li data-type='method'><a href="wsemi.html#.domShowInputAndGetFiles">domShowInputAndGetFiles</a></li><li data-type='method'><a href="wsemi.html#.domShowInputAndGetFilesU8Arrs">domShowInputAndGetFilesU8Arrs</a></li><li data-type='method'><a href="wsemi.html#.domTriggerEvent">domTriggerEvent</a></li><li data-type='method'><a href="wsemi.html#.downloadExcelFileFromData">downloadExcelFileFromData</a></li><li data-type='method'><a href="wsemi.html#.downloadExcelFileFromDataDyn">downloadExcelFileFromDataDyn</a></li><li data-type='method'><a href="wsemi.html#.downloadFileFromBlob">downloadFileFromBlob</a></li><li data-type='method'><a href="wsemi.html#.downloadFileFromText">downloadFileFromText</a></li><li data-type='method'><a href="wsemi.html#.downloadFileFromU8Arr">downloadFileFromU8Arr</a></li><li data-type='method'><a href="wsemi.html#.dtmapping">dtmapping</a></li><li data-type='method'><a href="wsemi.html#.dtpick">dtpick</a></li><li data-type='method'><a href="wsemi.html#.evem">evem</a></li><li data-type='method'><a href="wsemi.html#.execScript">execScript</a></li><li data-type='method'><a href="wsemi.html#.f2c">f2c</a></li><li data-type='method'><a href="wsemi.html#.files2data">files2data</a></li><li data-type='method'><a href="wsemi.html#.fsCleanFolder">fsCleanFolder</a></li><li data-type='method'><a href="wsemi.html#.fsCopyFolder">fsCopyFolder</a></li><li data-type='method'><a href="wsemi.html#.fsCreateFolder">fsCreateFolder</a></li><li data-type='method'><a href="wsemi.html#.fsDeleteFolder">fsDeleteFolder</a></li><li data-type='method'><a href="wsemi.html#.fsGetFilesInFolder">fsGetFilesInFolder</a></li><li data-type='method'><a href="wsemi.html#.fsGetFoldersInFolder">fsGetFoldersInFolder</a></li><li data-type='method'><a href="wsemi.html#.fsIsFile">fsIsFile</a></li><li data-type='method'><a href="wsemi.html#.fsIsFolder">fsIsFolder</a></li><li data-type='method'><a href="wsemi.html#.fsReadText">fsReadText</a></li><li data-type='method'><a href="wsemi.html#.fsTreeFolder">fsTreeFolder</a></li><li data-type='method'><a href="wsemi.html#.fsWriteText">fsWriteText</a></li><li data-type='method'><a href="wsemi.html#.genGradientColor">genGradientColor</a></li><li data-type='method'><a href="wsemi.html#.genID">genID</a></li><li data-type='method'><a href="wsemi.html#.genPm">genPm</a></li><li data-type='method'><a href="wsemi.html#.getBufferSize">getBufferSize</a></li><li data-type='method'><a href="wsemi.html#.getDataFromExcelFileU8Arr">getDataFromExcelFileU8Arr</a></li><li data-type='method'><a href="wsemi.html#.getDataFromExcelFileU8ArrDyn">getDataFromExcelFileU8ArrDyn</a></li><li data-type='method'><a href="wsemi.html#.getEnv">getEnv</a></li><li data-type='method'><a href="wsemi.html#.getFileAccept">getFileAccept</a></li><li data-type='method'><a href="wsemi.html#.getGlobal">getGlobal</a></li><li data-type='method'><a href="wsemi.html#.getltdtkeys">getltdtkeys</a></li><li data-type='method'><a href="wsemi.html#.getObjSize">getObjSize</a></li><li data-type='method'><a href="wsemi.html#.getTimeBetween">getTimeBetween</a></li><li data-type='method'><a href="wsemi.html#.getTimeFromUnit">getTimeFromUnit</a></li><li data-type='method'><a href="wsemi.html#.getTimeObject">getTimeObject</a></li><li data-type='method'><a href="wsemi.html#.getTimeRange">getTimeRange</a></li><li data-type='method'><a href="wsemi.html#.getUserAgent">getUserAgent</a></li><li data-type='method'><a href="wsemi.html#.getUserAgentDyn">getUserAgentDyn</a></li><li data-type='method'><a href="wsemi.html#.haskey">haskey</a></li><li data-type='method'><a href="wsemi.html#.hsl">hsl</a></li><li data-type='method'><a href="wsemi.html#.htmlDecode">htmlDecode</a></li><li data-type='method'><a href="wsemi.html#.htmlEncode">htmlEncode</a></li><li data-type='method'><a href="wsemi.html#.importResources">importResources</a></li><li data-type='method'><a href="wsemi.html#.isab">isab</a></li><li data-type='method'><a href="wsemi.html#.isarr">isarr</a></li><li data-type='method'><a href="wsemi.html#.isarr0">isarr0</a></li><li data-type='method'><a href="wsemi.html#.isblob">isblob</a></li><li data-type='method'><a href="wsemi.html#.isbol">isbol</a></li><li data-type='method'><a href="wsemi.html#.isday">isday</a></li><li data-type='method'><a href="wsemi.html#.isDev">isDev</a></li><li data-type='method'><a href="wsemi.html#.isearr">isearr</a></li><li data-type='method'><a href="wsemi.html#.isEleExistByID">isEleExistByID</a></li><li data-type='method'><a href="wsemi.html#.isEmail">isEmail</a></li><li data-type='method'><a href="wsemi.html#.iseobj">iseobj</a></li><li data-type='method'><a href="wsemi.html#.iser">iser</a></li><li data-type='method'><a href="wsemi.html#.isernot">isernot</a></li><li data-type='method'><a href="wsemi.html#.isestr">isestr</a></li><li data-type='method'><a href="wsemi.html#.isfun">isfun</a></li><li data-type='method'><a href="wsemi.html#.isint">isint</a></li><li data-type='method'><a href="wsemi.html#.ismonth">ismonth</a></li><li data-type='method'><a href="wsemi.html#.isn0int">isn0int</a></li><li data-type='method'><a href="wsemi.html#.isn0num">isn0num</a></li><li data-type='method'><a href="wsemi.html#.isNarrow">isNarrow</a></li><li data-type='method'><a href="wsemi.html#.isnbr">isnbr</a></li><li data-type='method'><a href="wsemi.html#.isnint">isnint</a></li><li data-type='method'><a href="wsemi.html#.isnull">isnull</a></li><li data-type='method'><a href="wsemi.html#.isnum">isnum</a></li><li data-type='method'><a href="wsemi.html#.isobj">isobj</a></li><li data-type='method'><a href="wsemi.html#.isobj0">isobj0</a></li><li data-type='method'><a href="wsemi.html#.isp0int">isp0int</a></li><li data-type='method'><a href="wsemi.html#.isp0num">isp0num</a></li><li data-type='method'><a href="wsemi.html#.ispint">ispint</a></li><li data-type='method'><a href="wsemi.html#.ispm">ispm</a></li><li data-type='method'><a href="wsemi.html#.isstr">isstr</a></li><li data-type='method'><a href="wsemi.html#.isstr0">isstr0</a></li><li data-type='method'><a href="wsemi.html#.isStrHasCapital">isStrHasCapital</a></li><li data-type='method'><a href="wsemi.html#.isStrHasLowerCase">isStrHasLowerCase</a></li><li data-type='method'><a href="wsemi.html#.isStrHasNumber">isStrHasNumber</a></li><li data-type='method'><a href="wsemi.html#.istime">istime</a></li><li data-type='method'><a href="wsemi.html#.istimeTZ">istimeTZ</a></li><li data-type='method'><a href="wsemi.html#.isu8arr">isu8arr</a></li><li data-type='method'><a href="wsemi.html#.isu16arr">isu16arr</a></li><li data-type='method'><a href="wsemi.html#.isundefined">isundefined</a></li><li data-type='method'><a href="wsemi.html#.isUserIdentify">isUserIdentify</a></li><li data-type='method'><a href="wsemi.html#.isUserName">isUserName</a></li><li data-type='method'><a href="wsemi.html#.isUserPW">isUserPW</a></li><li data-type='method'><a href="wsemi.html#.isWindow">isWindow</a></li><li data-type='method'><a href="wsemi.html#.j2o">j2o</a></li><li data-type='method'><a href="wsemi.html#.keysmat2ltdt">keysmat2ltdt</a></li><li data-type='method'><a href="wsemi.html#.ltdt2vrtsable">ltdt2vrtsable</a></li><li data-type='method'><a href="wsemi.html#.ltdtkeys2mat">ltdtkeys2mat</a></li><li data-type='method'><a href="wsemi.html#.ltdtkeysheads2mat">ltdtkeysheads2mat</a></li><li data-type='method'><a href="wsemi.html#.ltdtmapping">ltdtmapping</a></li><li data-type='method'><a href="wsemi.html#.ltdtmerge">ltdtmerge</a></li><li data-type='method'><a href="wsemi.html#.mat2ltdt">mat2ltdt</a></li><li data-type='method'><a href="wsemi.html#.matat">matat</a></li><li data-type='method'><a href="wsemi.html#.now2str">now2str</a></li><li data-type='method'><a href="wsemi.html#.now2strp">now2strp</a></li><li data-type='method'><a href="wsemi.html#.nowDay2str">nowDay2str</a></li><li data-type='method'><a href="wsemi.html#.o2j">o2j</a></li><li data-type='method'><a href="wsemi.html#.obj2b64">obj2b64</a></li><li data-type='method'><a href="wsemi.html#.obj2pb64">obj2pb64</a></li><li data-type='method'><a href="wsemi.html#.obj2str">obj2str</a></li><li data-type='method'><a href="wsemi.html#.obj2stru8arr">obj2stru8arr</a></li><li data-type='method'><a href="wsemi.html#.obj2u8arr">obj2u8arr</a></li><li data-type='method'><a href="wsemi.html#.onTooltip">onTooltip</a></li><li data-type='method'><a href="wsemi.html#.oo">oo</a></li><li data-type='method'><a href="wsemi.html#.openLink">openLink</a></li><li data-type='method'><a href="wsemi.html#.pb642obj">pb642obj</a></li><li data-type='method'><a href="wsemi.html#.pm2resolve">pm2resolve</a></li><li data-type='method'><a href="wsemi.html#.pmChain">pmChain</a></li><li data-type='method'><a href="wsemi.html#.pmHook">pmHook</a></li><li data-type='method'><a href="wsemi.html#.pmIni">pmIni</a></li><li data-type='method'><a href="wsemi.html#.pmLast">pmLast</a></li><li data-type='method'><a href="wsemi.html#.pmMap">pmMap</a></li><li data-type='method'><a href="wsemi.html#.pmQueue">pmQueue</a></li><li data-type='method'><a href="wsemi.html#.pmSeries">pmSeries</a></li><li data-type='method'><a href="wsemi.html#.queue">queue</a></li><li data-type='method'><a href="wsemi.html#.rep">rep</a></li><li data-type='method'><a href="wsemi.html#.replace">replace</a></li><li data-type='method'><a href="wsemi.html#.replaceObj">replaceObj</a></li><li data-type='method'><a href="wsemi.html#.replacePlus">replacePlus</a></li><li data-type='method'><a href="wsemi.html#.repObj">repObj</a></li><li data-type='method'><a href="wsemi.html#.round">round</a></li><li data-type='method'><a href="wsemi.html#.sep">sep</a></li><li data-type='method'><a href="wsemi.html#.sepInt">sepInt</a></li><li data-type='method'><a href="wsemi.html#.sepTimeTZ">sepTimeTZ</a></li><li data-type='method'><a href="wsemi.html#.showImages">showImages</a></li><li data-type='method'><a href="wsemi.html#.showImagesDyn">showImagesDyn</a></li><li data-type='method'><a href="wsemi.html#.split">split</a></li><li data-type='method'><a href="wsemi.html#.str2aes">str2aes</a></li><li data-type='method'><a href="wsemi.html#.str2b64">str2b64</a></li><li data-type='method'><a href="wsemi.html#.str2md5">str2md5</a></li><li data-type='method'><a href="wsemi.html#.str2obj">str2obj</a></li><li data-type='method'><a href="wsemi.html#.str2sha512">str2sha512</a></li><li data-type='method'><a href="wsemi.html#.str2u8arr">str2u8arr</a></li><li data-type='method'><a href="wsemi.html#.strCompare">strCompare</a></li><li data-type='method'><a href="wsemi.html#.strdelleft">strdelleft</a></li><li data-type='method'><a href="wsemi.html#.strdelright">strdelright</a></li><li data-type='method'><a href="wsemi.html#.strFindFuzz">strFindFuzz</a></li><li data-type='method'><a href="wsemi.html#.strFindFuzzDyn">strFindFuzzDyn</a></li><li data-type='method'><a href="wsemi.html#.strFindSimilar">strFindSimilar</a></li><li data-type='method'><a href="wsemi.html#.strleft">strleft</a></li><li data-type='method'><a href="wsemi.html#.strmid">strmid</a></li><li data-type='method'><a href="wsemi.html#.strright">strright</a></li><li data-type='method'><a href="wsemi.html#.stru8arr2obj">stru8arr2obj</a></li><li data-type='method'><a href="wsemi.html#.time2day">time2day</a></li><li data-type='method'><a href="wsemi.html#.time2expire">time2expire</a></li><li data-type='method'><a href="wsemi.html#.time2hour">time2hour</a></li><li data-type='method'><a href="wsemi.html#.time2min">time2min</a></li><li data-type='method'><a href="wsemi.html#.time2past">time2past</a></li><li data-type='method'><a href="wsemi.html#.timeTZ2day">timeTZ2day</a></li><li data-type='method'><a href="wsemi.html#.timeTZ2hour">timeTZ2hour</a></li><li data-type='method'><a href="wsemi.html#.timeTZ2min">timeTZ2min</a></li><li data-type='method'><a href="wsemi.html#.tinycolor">tinycolor</a></li><li data-type='method'><a href="wsemi.html#.treeObj">treeObj</a></li><li data-type='method'><a href="wsemi.html#.trim">trim</a></li><li data-type='method'><a href="wsemi.html#.u8arr2ab">u8arr2ab</a></li><li data-type='method'><a href="wsemi.html#.u8arr2b64">u8arr2b64</a></li><li data-type='method'><a href="wsemi.html#.u8arr2blob">u8arr2blob</a></li><li data-type='method'><a href="wsemi.html#.u8arr2bs">u8arr2bs</a></li><li data-type='method'><a href="wsemi.html#.u8arr2obj">u8arr2obj</a></li><li data-type='method'><a href="wsemi.html#.u8arr2str">u8arr2str</a></li><li data-type='method'><a href="wsemi.html#.u8arr2u16arr">u8arr2u16arr</a></li><li data-type='method'><a href="wsemi.html#.u16arr2b64">u16arr2b64</a></li><li data-type='method'><a href="wsemi.html#.u16arr2u8arr">u16arr2u8arr</a></li><li data-type='method'><a href="wsemi.html#.urlParse">urlParse</a></li><li data-type='method'><a href="wsemi.html#.verifyValue">verifyValue</a></li><li data-type='method'><a href="wsemi.html#.waitFun">waitFun</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">domDrag.mjs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import get from 'lodash/get'
import size from 'lodash/size'
import isnum from './isnum.mjs'
import iseobj from './iseobj.mjs'
import isestr from './isestr.mjs'
import isEle from './isEle.mjs'
import evem from './evem.mjs'
import getGlobal from './getGlobal.mjs'
// import domIsPageXYIn from './domIsPageXYIn.mjs' //已不使用
// import domGetOffset from './domGetOffset.mjs' //已不使用
//import Draggable from '@shopify/draggable/lib/draggable' //draggable.js沒有umd版, 故引用後即便用rollup剔除@shopify/draggable再打包, 還是會有未檢查window的殼層程式碼出現, 並再導致無法於nodejs環境下使用wsemi


function getDraggable() {
    let g = getGlobal()
    //let x = Draggable || g.Draggable
    let x = g.Draggable //直接取window內Draggable
    if (x.default) {
        x = x.default
    }
    return x
}


/**
 * 前端DOM元素拖曳功能
 *
 * Unit Test: {@link https://github.com/yuda-lyu/wsemi/blob/master/test/domDrag.test.js Github}
 * @memberOf wsemi
 * @param {HTMLElement} ele 輸入元素
 * @param {Object} [opt={}] 輸入設定物件，預設{}
 * @param {String} [opt.attIndex='dragindex'] 輸入標記元素順序指標字串，預設'dragindex'
 * @param {String} [opt.selectors='[dragtag]'] 輸入查詢元素用字串，主要是給draggable.js用來標記哪些元素可被拖曳之用，預設'[dragtag]'
 * @example
 * need test in browser
 */
function domDrag(ele, opt = {}) {
    let self = null
    let dragTo = null
    let tmsgDragMove = null

    //check
    if (!isEle(ele)) {
        console.log('ele is not HTMLElement', ele)
        return
    }
    let attIndex = get(opt, 'attIndex', 'dragindex')
    if (!isestr(attIndex)) {
        console.log('invalid attIndex in opt', attIndex)
        return
    }
    let selectors = get(opt, 'selectors', '[dragtag]')
    if (!isestr(selectors)) {
        console.log('invalid selectors in opt', selectors)
        return
    }

    function getAttr(el, attr) {
        let ind = null
        try {
            ind = el.getAttribute(attr)
        }
        catch (err) {}
        return ind
    }

    function getIndex(el) {
        return getAttr(el, attIndex)
    }

    function getBoudRect(el) {
        try {
            return el.getBoundingClientRect()
        }
        catch (err) {}
        return null
    }

    function getEle(ind) {
        let el = null
        try {
            el = ele.querySelector(`[${attIndex}="${ind}"]`)
        }
        catch (err) {}
        return el
    }

    //ev
    let ev = evem()

    //UseDraggable
    let UseDraggable = getDraggable()

    //draggable
    let draggable = new UseDraggable(ele, {
        draggable: selectors,
    })
    // console.log('draggable', draggable)

    //on
    draggable.on('drag:start', (de) => {
        // console.log('drag:start', de, de.originalSource)

        //self
        self = getIndex(de.originalSource)

        //check, 非數字
        if (!isnum(self)) {
            return
        }

        //msg
        let msg = {
            selfInd: self,
            selfEle: de.originalSource,
        }

        //emit
        ev.emit('drag-start', msg)
        ev.emit('change', { mode: 'drag-start', ...msg })

    })
    draggable.on('drag:move', (de) => {
        //console.log('drag:move', de)

        //check, 無拖曳進入drag-enter對象資料
        if (!iseobj(dragTo)) {
            //console.log('無拖曳進入對象')
            return
        }

        //check
        if (!de.source) {
            //console.log('找不到source元素')
            return
        }

        //oe
        let oe = get(de, 'sensorEvent.originalEvent', null)
        // console.log('oe', oe)

        //check
        if (!oe) {
            //console.log('找不到sensorEvent.originalEvent')
            return
        }

        //check
        if (!oe.target) {
            //console.log('找不到target元素')
            return
        }

        //已通過拖曳離開(drag:out)時清除dragTo, 且拖曳進入(drag:over)自己時不更新dragTo之機制, 避免拖曳回來原拖曳對象之問題
        // //isBack, 判斷滑鼠的pageX,Y是否位於原本拖曳對象內
        // let isBack = domIsPageXYIn(oe.pageX, oe.pageY, de.source) //若使用originalSource, 會因為被draggable隱藏無法取得bounding, 故改用source
        // // console.log('isBack', isBack)

        // //check
        // if (isBack) {
        //     // console.log('拖曳回到原本拖曳對象內故取消事件')
        //     return
        // }

        //isOuter
        let isOuter = oe.target.contains(dragTo.ele)
        // console.log('isOuter', isOuter)

        //check
        if (isOuter) {
            //console.log('拖曳至外層元素故取消事件')
            return
        }

        //因A拖曳至B再拖曳至C後, 由C拖曳回B時會觸發, 但此時是合理拖曳行為故不能使用此檢核, 且手機拖曳時target會提供原拖曳對象導致此條件必定成立而不能使用此檢核
        // //isIndependent
        // let isIndependent = !dragTo.ele.contains(oe.target)
        // //console.log('isIndependent', isIndependent)

        // //check
        // if (isIndependent) {
        //     console.log('拖曳至非所屬元素內故取消事件')
        //     return
        // }

        //p, 若有touches為手機拖曳
        let p = null
        if (oe.touches) {
            if (size(oe.touches) > 1) {
                //console.log('多點拖曳故取消事件')
                return
            }
            p = oe.touches[0] //clientX,Y是放在各touches內, 此處只允許單點拖曳
        }
        else {
            p = oe //clientX,Y是原本事件就有提供
        }

        //rt
        let rt = getBoudRect(dragTo.ele) //rect的left,top為基於瀏覽器可視區域左上角的座標
        // console.log('rt', rt)

        //x, y, w, h, rx, ry
        let x = p.clientX - rt.left //事件的clientX,Y是基於瀏覽器可視區域左上角的座標
        let y = p.clientY - rt.top
        let w = get(dragTo, 'ele.offsetWidth', 0)
        let h = get(dragTo, 'ele.offsetHeight', 0)
        let rx = 0
        if (w > 0) {
            rx = x / w
        }
        let ry = 0
        if (h > 0) {
            ry = y / h
        }
        // console.log('y', y)
        // console.log('h', h)
        // console.log('ry', ry)

        //cursorInfor
        let cursorInfor = {
            x,
            y,
            w,
            h,
            rx,
            ry,
        }

        //check, 若靠近元素底部移動並移出時, 可能因有包覆層導致觸發drag:move, 但其offsetX,offsetY會很靠近0, 導致滑鼠所在位置的比例計算錯誤, 故給予門檻偵測並跳出
        if (get(tmsgDragMove, 'enterInd', null) === dragTo.ind) {
            if (tmsgDragMove.cursorInfor.ry > 0.95 &amp;&amp; ry &lt; 0.05) {
                // console.log('同高之包覆層無效y向移動觸發故取消事件')
                return
            }
            if (tmsgDragMove.cursorInfor.rx > 0.95 &amp;&amp; rx &lt; 0.05) {
                // console.log('同寬之包覆層無效x向移動觸發故取消事件')
                return
            }
        }

        //msg
        let msg = {
            selfInd: self,
            selfEle: de.originalSource,
            enterInd: dragTo.ind,
            enterEle: dragTo.ele,
            enterEvent: oe,
            cursorInfor,
        }

        //save
        tmsgDragMove = msg

        //emit
        ev.emit('drag-move', msg)
        ev.emit('change', { mode: 'drag-move', ...msg })

    })
    draggable.on('drag:over', (de) => {
        //console.log('drag:over', de, de.over)

        //ind
        let ind = getIndex(de.over)

        //check, 非數字
        if (!isnum(self) || !isnum(ind)) {
            return
        }

        //check, 等於原始拖曳對象
        if (self === ind) {
            return
        }

        //check, 已觸發拖曳進入drag-enter
        if (ind === get(dragTo, 'ind')) {
            return
        }

        //update dragTo
        dragTo = {
            ind,
            ele: de.over,
        }

        //msg
        let msg = {
            selfInd: self,
            selfEle: de.originalSource,
            enterInd: ind,
            enterEle: de.over, //getEle(ind),
        }

        //emit
        ev.emit('drag-enter', msg)
        ev.emit('change', { mode: 'drag-enter', ...msg })

    })
    // draggable.on('drag:over:container', (de) => {
    //     console.log('drag:over:container', de, de.over)
    // })
    draggable.on('drag:out', (de) => {
        //console.log('drag:out', de, de.over)

        //ind
        let ind = getIndex(de.over)

        //check, 非數字
        if (!isnum(self) || !isnum(ind)) {
            return
        }

        //check, 等於原始拖曳對象
        if (self === ind) {
            return
        }

        //check, 已觸發拖曳離開drag-leave
        if (!dragTo) {
            return
        }

        //update dragTo
        dragTo = null

        //msg
        let msg = {
            selfInd: self,
            selfEle: de.originalSource,
            leaveInd: ind,
            leaveEle: de.over, //getEle(ind),
        }

        //emit
        ev.emit('drag-leave', msg)
        ev.emit('change', { mode: 'drag-leave', ...msg })

    })
    // draggable.on('drag:out:container', (de) => {
    //     console.log('drag:out:containerr', de, de.over)
    // })
    draggable.on('drag:stop', (de) => {
        //console.log('drag:stop', de, de.source)

        //check
        if (!isnum(self) || !isnum(get(dragTo, 'ind'))) {
            return
        }

        //check
        if (self === dragTo.ind) {
            return
        }

        //msg
        let msg = {
            selfInd: self,
            selfEle: de.originalSource,
            dropInd: dragTo.ind,
            dropEle: getEle(dragTo.ind),
        }

        //emit
        ev.emit('drag-drop', msg)
        ev.emit('change', { mode: 'drag-drop', ...msg })

        //update dragTo
        dragTo = null

    })

    //save draggable, 一定要把draggable送出才能呼叫其內destroy, 因draggable內使用this處理相關呼叫, 不回傳整個draggable會導致this實際為ev而導致無法使用
    ev.draggable = draggable

    return ev
}


export default domDrag
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Tue May 26 2020 14:09:57 GMT+0800 (台北標準時間) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
