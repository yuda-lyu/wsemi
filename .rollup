import commonjs from 'rollup-plugin-commonjs'
import resolve from 'rollup-plugin-node-resolve'
import postcss from 'rollup-plugin-postcss'
import babel from 'rollup-plugin-babel'
import minify from 'rollup-plugin-babel-minify'
import fs from 'fs'
 
 
let pkg=JSON.parse(fs.readFileSync('package.json', 'utf8'))

let optBabel={
      runtimeHelpers: true,
      exclude: 'node_modules/**',
      presets: [
        [
          "@babel/preset-env",
          {
            useBuiltIns: 'entry', //entry usage, usage is not stable
            corejs: 3,
          }
        ]
      ],
    }

export default {
  input: 'src/index.mjs',
  output: {
    banner: '/*!\n * wsemi v' + pkg.version + '\n * (c) 2018-2019 ' + pkg.author + '\n * Released under the MIT License.\n */',
    globals: { //指定內外模組的關聯性，左邊為內部使用之模組名稱，右邊為外部提供之模組名稱
      'fs': 'fs',
      //'url': 'url',
      //'path': 'path',
      'child_process': 'child_process',
      'dayjs': 'dayjs',
      'xlsx': 'XLSX',
      'fuzzball': 'fuzzball',
      'tippy.js': 'tippy',
      'ua-parser-js': 'UAParser',
      'xss': 'filterXSS',
      '@ctrl/tinycolor': 'tinycolor',
    },
    format: 'umd', //iife, umd
    name: 'wsemi', //iife時名稱內不能使用「-」
    file: 'dist/wsemi.umd.js',
    sourcemap: true
  },
  external: [ //指定哪些內部模組需引用外部模組
      'fs',
      //'url',
      //'path',
      'child_process',
      'dayjs',
      'xlsx',
      'fuzzball',
      'tippy.js', //內部套件名稱
      'ua-parser-js',
      'xss',
      '@ctrl/tinycolor',
  ], 
  plugins: [
    commonjs(),
    resolve({
        preferBuiltins: false,
        browser: true,
    }),
    babel(optBabel),
    postcss({
      extensions: ['.css']
    }),
    minify({ comments: false, }),
  ]
}

