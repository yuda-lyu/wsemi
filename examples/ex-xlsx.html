<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>examples for xlsx</title>
    
    <script nomodule src="https://cdn.jsdelivr.net/npm/@babel/polyfill/dist/polyfill.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/js-xlsx/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/wsemi@1.1.0/dist/wsemi.umd.js"></script>

    <script>
        console.log = function () {
            //覆蓋log
            function htmlEncode(str) {
                let ele=document.createElement('span')
                ele.appendChild( document.createTextNode(str))
                return ele.innerHTML
            }
            let v=Array.prototype.slice.call(arguments).map(function(v){return wsemi.o2j(v)}).join(', ')
            let s=''
            s+='<div style="padding:5px; font-size:10pt; font-family:Microsoft JhengHei, Helvetica;">'
            s+='<span style="color:#f26;">log: </span>'
            s+='<code>'+htmlEncode(v)+'</code>'
            s+='</div>'
            document
                .querySelector('body')
                .insertAdjacentHTML('beforeend', s)
        }
    </script>
    
</head>
<body>

    <button onclick="testXLSX()">read file(*.xlsx) from xlsx</button>

    <script>
            
        function testXLSX(){

            let kind = 'xlsx'
            //kind = 'common'
            wsemi.domShowInputAndGetFilesU8Arrs(kind)
                .then(function(d) {

                    //get first file
                    let file = d[0]

                    //u8a
                    let u8a = file.u8a
                    console.log('u8a', Object.prototype.toString.call(u8a), u8a.length)

                    //download u8a
                    wsemi.downloadFileFromU8Arr('temp.xlsx', u8a)

                    //dcsv
                    let dcsv = wsemi.getDataFromExcelFileU8Arr(u8a, 'csv')
                    dcsv = dcsv[0]
                    console.log('dcsv', dcsv.sheetname, dcsv.data)

                    //download csv
                    wsemi.downloadFileFromText('temp.csv', dcsv.data)

                    //dltdt
                    let dltdt = wsemi.getDataFromExcelFileU8Arr(u8a, 'ltdt')
                    dltdt = dltdt[0]
                    console.log('dltdt', dltdt.sheetname, dltdt.data)

                    //download json
                    wsemi.downloadFileFromText('temp.json', JSON.stringify(dltdt))

                    //darray
                    let darray = wsemi.getDataFromExcelFileU8Arr(u8a, 'array')
                    darray = darray[0]
                    console.log('darray', darray.sheetname, darray.data.rows)

                    //download array
                    wsemi.downloadExcelFileFromData('temp.array.xlsx', 'data', darray.data.rows)

                })
                .catch(function(msg){
                    console.log(msg)
                })

        }

    </script>
  
</body>
</html>